{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.collectMethods = exports.LooksAhead = void 0;\nvar lookahead_1 = require(\"../../grammar/lookahead\");\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\nvar has_1 = __importDefault(require(\"lodash/has\"));\nvar parser_1 = require(\"../parser\");\nvar keys_1 = require(\"../../grammar/keys\");\nvar gast_1 = require(\"@chevrotain/gast\");\nvar gast_2 = require(\"@chevrotain/gast\");\n/**\n * Trait responsible for the lookahead related utilities and optimizations.\n */\nvar LooksAhead = /** @class */function () {\n  function LooksAhead() {}\n  LooksAhead.prototype.initLooksAhead = function (config) {\n    this.dynamicTokensEnabled = (0, has_1.default)(config, \"dynamicTokensEnabled\") ? config.dynamicTokensEnabled // assumes end user provides the correct config value/type\n    : parser_1.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled;\n    this.maxLookahead = (0, has_1.default)(config, \"maxLookahead\") ? config.maxLookahead // assumes end user provides the correct config value/type\n    : parser_1.DEFAULT_PARSER_CONFIG.maxLookahead;\n    this.lookAheadFuncsCache = new Map();\n  };\n  LooksAhead.prototype.preComputeLookaheadFunctions = function (rules) {\n    var _this = this;\n    (0, forEach_1.default)(rules, function (currRule) {\n      _this.TRACE_INIT(\"\".concat(currRule.name, \" Rule Lookahead\"), function () {\n        var _a = collectMethods(currRule),\n          alternation = _a.alternation,\n          repetition = _a.repetition,\n          option = _a.option,\n          repetitionMandatory = _a.repetitionMandatory,\n          repetitionMandatoryWithSeparator = _a.repetitionMandatoryWithSeparator,\n          repetitionWithSeparator = _a.repetitionWithSeparator;\n        (0, forEach_1.default)(alternation, function (currProd) {\n          var prodIdx = currProd.idx === 0 ? \"\" : currProd.idx;\n          _this.TRACE_INIT(\"\".concat((0, gast_2.getProductionDslName)(currProd)).concat(prodIdx), function () {\n            var laFunc = (0, lookahead_1.buildLookaheadFuncForOr)(currProd.idx, currRule, currProd.maxLookahead || _this.maxLookahead, currProd.hasPredicates, _this.dynamicTokensEnabled, _this.lookAheadBuilderForAlternatives);\n            var key = (0, keys_1.getKeyForAutomaticLookahead)(_this.fullRuleNameToShort[currRule.name], keys_1.OR_IDX, currProd.idx);\n            _this.setLaFuncCache(key, laFunc);\n          });\n        });\n        (0, forEach_1.default)(repetition, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.MANY_IDX, lookahead_1.PROD_TYPE.REPETITION, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n        (0, forEach_1.default)(option, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.OPTION_IDX, lookahead_1.PROD_TYPE.OPTION, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n        (0, forEach_1.default)(repetitionMandatory, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.AT_LEAST_ONE_IDX, lookahead_1.PROD_TYPE.REPETITION_MANDATORY, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n        (0, forEach_1.default)(repetitionMandatoryWithSeparator, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.AT_LEAST_ONE_SEP_IDX, lookahead_1.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n        (0, forEach_1.default)(repetitionWithSeparator, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.MANY_SEP_IDX, lookahead_1.PROD_TYPE.REPETITION_WITH_SEPARATOR, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n      });\n    });\n  };\n  LooksAhead.prototype.computeLookaheadFunc = function (rule, prodOccurrence, prodKey, prodType, prodMaxLookahead, dslMethodName) {\n    var _this = this;\n    this.TRACE_INIT(\"\".concat(dslMethodName).concat(prodOccurrence === 0 ? \"\" : prodOccurrence), function () {\n      var laFunc = (0, lookahead_1.buildLookaheadFuncForOptionalProd)(prodOccurrence, rule, prodMaxLookahead || _this.maxLookahead, _this.dynamicTokensEnabled, prodType, _this.lookAheadBuilderForOptional);\n      var key = (0, keys_1.getKeyForAutomaticLookahead)(_this.fullRuleNameToShort[rule.name], prodKey, prodOccurrence);\n      _this.setLaFuncCache(key, laFunc);\n    });\n  };\n  LooksAhead.prototype.lookAheadBuilderForOptional = function (alt, tokenMatcher, dynamicTokensEnabled) {\n    return (0, lookahead_1.buildSingleAlternativeLookaheadFunction)(alt, tokenMatcher, dynamicTokensEnabled);\n  };\n  LooksAhead.prototype.lookAheadBuilderForAlternatives = function (alts, hasPredicates, tokenMatcher, dynamicTokensEnabled) {\n    return (0, lookahead_1.buildAlternativesLookAheadFunc)(alts, hasPredicates, tokenMatcher, dynamicTokensEnabled);\n  };\n  // this actually returns a number, but it is always used as a string (object prop key)\n  LooksAhead.prototype.getKeyForAutomaticLookahead = function (dslMethodIdx, occurrence) {\n    var currRuleShortName = this.getLastExplicitRuleShortName();\n    return (0, keys_1.getKeyForAutomaticLookahead)(currRuleShortName, dslMethodIdx, occurrence);\n  };\n  LooksAhead.prototype.getLaFuncFromCache = function (key) {\n    return this.lookAheadFuncsCache.get(key);\n  };\n  /* istanbul ignore next */\n  LooksAhead.prototype.setLaFuncCache = function (key, value) {\n    this.lookAheadFuncsCache.set(key, value);\n  };\n  return LooksAhead;\n}();\nexports.LooksAhead = LooksAhead;\nvar DslMethodsCollectorVisitor = /** @class */function (_super) {\n  __extends(DslMethodsCollectorVisitor, _super);\n  function DslMethodsCollectorVisitor() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.dslMethods = {\n      option: [],\n      alternation: [],\n      repetition: [],\n      repetitionWithSeparator: [],\n      repetitionMandatory: [],\n      repetitionMandatoryWithSeparator: []\n    };\n    return _this;\n  }\n  DslMethodsCollectorVisitor.prototype.reset = function () {\n    this.dslMethods = {\n      option: [],\n      alternation: [],\n      repetition: [],\n      repetitionWithSeparator: [],\n      repetitionMandatory: [],\n      repetitionMandatoryWithSeparator: []\n    };\n  };\n  DslMethodsCollectorVisitor.prototype.visitOption = function (option) {\n    this.dslMethods.option.push(option);\n  };\n  DslMethodsCollectorVisitor.prototype.visitRepetitionWithSeparator = function (manySep) {\n    this.dslMethods.repetitionWithSeparator.push(manySep);\n  };\n  DslMethodsCollectorVisitor.prototype.visitRepetitionMandatory = function (atLeastOne) {\n    this.dslMethods.repetitionMandatory.push(atLeastOne);\n  };\n  DslMethodsCollectorVisitor.prototype.visitRepetitionMandatoryWithSeparator = function (atLeastOneSep) {\n    this.dslMethods.repetitionMandatoryWithSeparator.push(atLeastOneSep);\n  };\n  DslMethodsCollectorVisitor.prototype.visitRepetition = function (many) {\n    this.dslMethods.repetition.push(many);\n  };\n  DslMethodsCollectorVisitor.prototype.visitAlternation = function (or) {\n    this.dslMethods.alternation.push(or);\n  };\n  return DslMethodsCollectorVisitor;\n}(gast_1.GAstVisitor);\nvar collectorVisitor = new DslMethodsCollectorVisitor();\nfunction collectMethods(rule) {\n  collectorVisitor.reset();\n  rule.accept(collectorVisitor);\n  var dslMethods = collectorVisitor.dslMethods;\n  // avoid uncleaned references\n  collectorVisitor.reset();\n  return dslMethods;\n}\nexports.collectMethods = collectMethods;","map":{"version":3,"sources":["../../../../../src/parse/parser/traits/looksahead.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.collectMethods = exports.LooksAhead = void 0;\nvar lookahead_1 = require(\"../../grammar/lookahead\");\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\nvar has_1 = __importDefault(require(\"lodash/has\"));\nvar parser_1 = require(\"../parser\");\nvar keys_1 = require(\"../../grammar/keys\");\nvar gast_1 = require(\"@chevrotain/gast\");\nvar gast_2 = require(\"@chevrotain/gast\");\n/**\n * Trait responsible for the lookahead related utilities and optimizations.\n */\nvar LooksAhead = /** @class */ (function () {\n    function LooksAhead() {\n    }\n    LooksAhead.prototype.initLooksAhead = function (config) {\n        this.dynamicTokensEnabled = (0, has_1.default)(config, \"dynamicTokensEnabled\")\n            ? config.dynamicTokensEnabled // assumes end user provides the correct config value/type\n            : parser_1.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled;\n        this.maxLookahead = (0, has_1.default)(config, \"maxLookahead\")\n            ? config.maxLookahead // assumes end user provides the correct config value/type\n            : parser_1.DEFAULT_PARSER_CONFIG.maxLookahead;\n        this.lookAheadFuncsCache = new Map();\n    };\n    LooksAhead.prototype.preComputeLookaheadFunctions = function (rules) {\n        var _this = this;\n        (0, forEach_1.default)(rules, function (currRule) {\n            _this.TRACE_INIT(\"\".concat(currRule.name, \" Rule Lookahead\"), function () {\n                var _a = collectMethods(currRule), alternation = _a.alternation, repetition = _a.repetition, option = _a.option, repetitionMandatory = _a.repetitionMandatory, repetitionMandatoryWithSeparator = _a.repetitionMandatoryWithSeparator, repetitionWithSeparator = _a.repetitionWithSeparator;\n                (0, forEach_1.default)(alternation, function (currProd) {\n                    var prodIdx = currProd.idx === 0 ? \"\" : currProd.idx;\n                    _this.TRACE_INIT(\"\".concat((0, gast_2.getProductionDslName)(currProd)).concat(prodIdx), function () {\n                        var laFunc = (0, lookahead_1.buildLookaheadFuncForOr)(currProd.idx, currRule, currProd.maxLookahead || _this.maxLookahead, currProd.hasPredicates, _this.dynamicTokensEnabled, _this.lookAheadBuilderForAlternatives);\n                        var key = (0, keys_1.getKeyForAutomaticLookahead)(_this.fullRuleNameToShort[currRule.name], keys_1.OR_IDX, currProd.idx);\n                        _this.setLaFuncCache(key, laFunc);\n                    });\n                });\n                (0, forEach_1.default)(repetition, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.MANY_IDX, lookahead_1.PROD_TYPE.REPETITION, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n                (0, forEach_1.default)(option, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.OPTION_IDX, lookahead_1.PROD_TYPE.OPTION, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n                (0, forEach_1.default)(repetitionMandatory, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.AT_LEAST_ONE_IDX, lookahead_1.PROD_TYPE.REPETITION_MANDATORY, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n                (0, forEach_1.default)(repetitionMandatoryWithSeparator, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.AT_LEAST_ONE_SEP_IDX, lookahead_1.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n                (0, forEach_1.default)(repetitionWithSeparator, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.MANY_SEP_IDX, lookahead_1.PROD_TYPE.REPETITION_WITH_SEPARATOR, currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n            });\n        });\n    };\n    LooksAhead.prototype.computeLookaheadFunc = function (rule, prodOccurrence, prodKey, prodType, prodMaxLookahead, dslMethodName) {\n        var _this = this;\n        this.TRACE_INIT(\"\".concat(dslMethodName).concat(prodOccurrence === 0 ? \"\" : prodOccurrence), function () {\n            var laFunc = (0, lookahead_1.buildLookaheadFuncForOptionalProd)(prodOccurrence, rule, prodMaxLookahead || _this.maxLookahead, _this.dynamicTokensEnabled, prodType, _this.lookAheadBuilderForOptional);\n            var key = (0, keys_1.getKeyForAutomaticLookahead)(_this.fullRuleNameToShort[rule.name], prodKey, prodOccurrence);\n            _this.setLaFuncCache(key, laFunc);\n        });\n    };\n    LooksAhead.prototype.lookAheadBuilderForOptional = function (alt, tokenMatcher, dynamicTokensEnabled) {\n        return (0, lookahead_1.buildSingleAlternativeLookaheadFunction)(alt, tokenMatcher, dynamicTokensEnabled);\n    };\n    LooksAhead.prototype.lookAheadBuilderForAlternatives = function (alts, hasPredicates, tokenMatcher, dynamicTokensEnabled) {\n        return (0, lookahead_1.buildAlternativesLookAheadFunc)(alts, hasPredicates, tokenMatcher, dynamicTokensEnabled);\n    };\n    // this actually returns a number, but it is always used as a string (object prop key)\n    LooksAhead.prototype.getKeyForAutomaticLookahead = function (dslMethodIdx, occurrence) {\n        var currRuleShortName = this.getLastExplicitRuleShortName();\n        return (0, keys_1.getKeyForAutomaticLookahead)(currRuleShortName, dslMethodIdx, occurrence);\n    };\n    LooksAhead.prototype.getLaFuncFromCache = function (key) {\n        return this.lookAheadFuncsCache.get(key);\n    };\n    /* istanbul ignore next */\n    LooksAhead.prototype.setLaFuncCache = function (key, value) {\n        this.lookAheadFuncsCache.set(key, value);\n    };\n    return LooksAhead;\n}());\nexports.LooksAhead = LooksAhead;\nvar DslMethodsCollectorVisitor = /** @class */ (function (_super) {\n    __extends(DslMethodsCollectorVisitor, _super);\n    function DslMethodsCollectorVisitor() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.dslMethods = {\n            option: [],\n            alternation: [],\n            repetition: [],\n            repetitionWithSeparator: [],\n            repetitionMandatory: [],\n            repetitionMandatoryWithSeparator: []\n        };\n        return _this;\n    }\n    DslMethodsCollectorVisitor.prototype.reset = function () {\n        this.dslMethods = {\n            option: [],\n            alternation: [],\n            repetition: [],\n            repetitionWithSeparator: [],\n            repetitionMandatory: [],\n            repetitionMandatoryWithSeparator: []\n        };\n    };\n    DslMethodsCollectorVisitor.prototype.visitOption = function (option) {\n        this.dslMethods.option.push(option);\n    };\n    DslMethodsCollectorVisitor.prototype.visitRepetitionWithSeparator = function (manySep) {\n        this.dslMethods.repetitionWithSeparator.push(manySep);\n    };\n    DslMethodsCollectorVisitor.prototype.visitRepetitionMandatory = function (atLeastOne) {\n        this.dslMethods.repetitionMandatory.push(atLeastOne);\n    };\n    DslMethodsCollectorVisitor.prototype.visitRepetitionMandatoryWithSeparator = function (atLeastOneSep) {\n        this.dslMethods.repetitionMandatoryWithSeparator.push(atLeastOneSep);\n    };\n    DslMethodsCollectorVisitor.prototype.visitRepetition = function (many) {\n        this.dslMethods.repetition.push(many);\n    };\n    DslMethodsCollectorVisitor.prototype.visitAlternation = function (or) {\n        this.dslMethods.alternation.push(or);\n    };\n    return DslMethodsCollectorVisitor;\n}(gast_1.GAstVisitor));\nvar collectorVisitor = new DslMethodsCollectorVisitor();\nfunction collectMethods(rule) {\n    collectorVisitor.reset();\n    rule.accept(collectorVisitor);\n    var dslMethods = collectorVisitor.dslMethods;\n    // avoid uncleaned references\n    collectorVisitor.reset();\n    return dslMethods;\n}\nexports.collectMethods = collectMethods;\n//# sourceMappingURL=looksahead.js.map"]},"metadata":{},"sourceType":"script"}