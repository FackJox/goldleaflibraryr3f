{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.serializeProduction = exports.serializeGrammar = exports.Terminal = exports.Alternation = exports.RepetitionWithSeparator = exports.Repetition = exports.RepetitionMandatoryWithSeparator = exports.RepetitionMandatory = exports.Option = exports.Alternative = exports.Rule = exports.NonTerminal = exports.AbstractProduction = void 0;\nvar map_1 = __importDefault(require(\"lodash/map\"));\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\nvar isString_1 = __importDefault(require(\"lodash/isString\"));\nvar isRegExp_1 = __importDefault(require(\"lodash/isRegExp\"));\nvar pickBy_1 = __importDefault(require(\"lodash/pickBy\"));\nvar assign_1 = __importDefault(require(\"lodash/assign\"));\n// TODO: duplicated code to avoid extracting another sub-package -- how to avoid?\nfunction tokenLabel(tokType) {\n  if (hasTokenLabel(tokType)) {\n    return tokType.LABEL;\n  } else {\n    return tokType.name;\n  }\n}\n// TODO: duplicated code to avoid extracting another sub-package -- how to avoid?\nfunction hasTokenLabel(obj) {\n  return (0, isString_1.default)(obj.LABEL) && obj.LABEL !== \"\";\n}\nvar AbstractProduction = /** @class */function () {\n  function AbstractProduction(_definition) {\n    this._definition = _definition;\n  }\n  Object.defineProperty(AbstractProduction.prototype, \"definition\", {\n    get: function get() {\n      return this._definition;\n    },\n    set: function set(value) {\n      this._definition = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  AbstractProduction.prototype.accept = function (visitor) {\n    visitor.visit(this);\n    (0, forEach_1.default)(this.definition, function (prod) {\n      prod.accept(visitor);\n    });\n  };\n  return AbstractProduction;\n}();\nexports.AbstractProduction = AbstractProduction;\nvar NonTerminal = /** @class */function (_super) {\n  __extends(NonTerminal, _super);\n  function NonTerminal(options) {\n    var _this = _super.call(this, []) || this;\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n  Object.defineProperty(NonTerminal.prototype, \"definition\", {\n    get: function get() {\n      if (this.referencedRule !== undefined) {\n        return this.referencedRule.definition;\n      }\n      return [];\n    },\n    set: function set(definition) {\n      // immutable\n    },\n    enumerable: false,\n    configurable: true\n  });\n  NonTerminal.prototype.accept = function (visitor) {\n    visitor.visit(this);\n    // don't visit children of a reference, we will get cyclic infinite loops if we do so\n  };\n\n  return NonTerminal;\n}(AbstractProduction);\nexports.NonTerminal = NonTerminal;\nvar Rule = /** @class */function (_super) {\n  __extends(Rule, _super);\n  function Rule(options) {\n    var _this = _super.call(this, options.definition) || this;\n    _this.orgText = \"\";\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n  return Rule;\n}(AbstractProduction);\nexports.Rule = Rule;\nvar Alternative = /** @class */function (_super) {\n  __extends(Alternative, _super);\n  function Alternative(options) {\n    var _this = _super.call(this, options.definition) || this;\n    _this.ignoreAmbiguities = false;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n  return Alternative;\n}(AbstractProduction);\nexports.Alternative = Alternative;\nvar Option = /** @class */function (_super) {\n  __extends(Option, _super);\n  function Option(options) {\n    var _this = _super.call(this, options.definition) || this;\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n  return Option;\n}(AbstractProduction);\nexports.Option = Option;\nvar RepetitionMandatory = /** @class */function (_super) {\n  __extends(RepetitionMandatory, _super);\n  function RepetitionMandatory(options) {\n    var _this = _super.call(this, options.definition) || this;\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n  return RepetitionMandatory;\n}(AbstractProduction);\nexports.RepetitionMandatory = RepetitionMandatory;\nvar RepetitionMandatoryWithSeparator = /** @class */function (_super) {\n  __extends(RepetitionMandatoryWithSeparator, _super);\n  function RepetitionMandatoryWithSeparator(options) {\n    var _this = _super.call(this, options.definition) || this;\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n  return RepetitionMandatoryWithSeparator;\n}(AbstractProduction);\nexports.RepetitionMandatoryWithSeparator = RepetitionMandatoryWithSeparator;\nvar Repetition = /** @class */function (_super) {\n  __extends(Repetition, _super);\n  function Repetition(options) {\n    var _this = _super.call(this, options.definition) || this;\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n  return Repetition;\n}(AbstractProduction);\nexports.Repetition = Repetition;\nvar RepetitionWithSeparator = /** @class */function (_super) {\n  __extends(RepetitionWithSeparator, _super);\n  function RepetitionWithSeparator(options) {\n    var _this = _super.call(this, options.definition) || this;\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n  return RepetitionWithSeparator;\n}(AbstractProduction);\nexports.RepetitionWithSeparator = RepetitionWithSeparator;\nvar Alternation = /** @class */function (_super) {\n  __extends(Alternation, _super);\n  function Alternation(options) {\n    var _this = _super.call(this, options.definition) || this;\n    _this.idx = 1;\n    _this.ignoreAmbiguities = false;\n    _this.hasPredicates = false;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n  Object.defineProperty(Alternation.prototype, \"definition\", {\n    get: function get() {\n      return this._definition;\n    },\n    set: function set(value) {\n      this._definition = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return Alternation;\n}(AbstractProduction);\nexports.Alternation = Alternation;\nvar Terminal = /** @class */function () {\n  function Terminal(options) {\n    this.idx = 1;\n    (0, assign_1.default)(this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n  }\n  Terminal.prototype.accept = function (visitor) {\n    visitor.visit(this);\n  };\n  return Terminal;\n}();\nexports.Terminal = Terminal;\nfunction serializeGrammar(topRules) {\n  return (0, map_1.default)(topRules, serializeProduction);\n}\nexports.serializeGrammar = serializeGrammar;\nfunction serializeProduction(node) {\n  function convertDefinition(definition) {\n    return (0, map_1.default)(definition, serializeProduction);\n  }\n  /* istanbul ignore else */\n  if (node instanceof NonTerminal) {\n    var serializedNonTerminal = {\n      type: \"NonTerminal\",\n      name: node.nonTerminalName,\n      idx: node.idx\n    };\n    if ((0, isString_1.default)(node.label)) {\n      serializedNonTerminal.label = node.label;\n    }\n    return serializedNonTerminal;\n  } else if (node instanceof Alternative) {\n    return {\n      type: \"Alternative\",\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Option) {\n    return {\n      type: \"Option\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof RepetitionMandatory) {\n    return {\n      type: \"RepetitionMandatory\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof RepetitionMandatoryWithSeparator) {\n    return {\n      type: \"RepetitionMandatoryWithSeparator\",\n      idx: node.idx,\n      separator: serializeProduction(new Terminal({\n        terminalType: node.separator\n      })),\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof RepetitionWithSeparator) {\n    return {\n      type: \"RepetitionWithSeparator\",\n      idx: node.idx,\n      separator: serializeProduction(new Terminal({\n        terminalType: node.separator\n      })),\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Repetition) {\n    return {\n      type: \"Repetition\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Alternation) {\n    return {\n      type: \"Alternation\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Terminal) {\n    var serializedTerminal = {\n      type: \"Terminal\",\n      name: node.terminalType.name,\n      label: tokenLabel(node.terminalType),\n      idx: node.idx\n    };\n    if ((0, isString_1.default)(node.label)) {\n      serializedTerminal.terminalLabel = node.label;\n    }\n    var pattern = node.terminalType.PATTERN;\n    if (node.terminalType.PATTERN) {\n      serializedTerminal.pattern = (0, isRegExp_1.default)(pattern) ? pattern.source : pattern;\n    }\n    return serializedTerminal;\n  } else if (node instanceof Rule) {\n    return {\n      type: \"Rule\",\n      name: node.name,\n      orgText: node.orgText,\n      definition: convertDefinition(node.definition)\n    };\n  } else {\n    throw Error(\"non exhaustive match\");\n  }\n}\nexports.serializeProduction = serializeProduction;","map":{"version":3,"sources":["../../src/model.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.serializeProduction = exports.serializeGrammar = exports.Terminal = exports.Alternation = exports.RepetitionWithSeparator = exports.Repetition = exports.RepetitionMandatoryWithSeparator = exports.RepetitionMandatory = exports.Option = exports.Alternative = exports.Rule = exports.NonTerminal = exports.AbstractProduction = void 0;\nvar map_1 = __importDefault(require(\"lodash/map\"));\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\nvar isString_1 = __importDefault(require(\"lodash/isString\"));\nvar isRegExp_1 = __importDefault(require(\"lodash/isRegExp\"));\nvar pickBy_1 = __importDefault(require(\"lodash/pickBy\"));\nvar assign_1 = __importDefault(require(\"lodash/assign\"));\n// TODO: duplicated code to avoid extracting another sub-package -- how to avoid?\nfunction tokenLabel(tokType) {\n    if (hasTokenLabel(tokType)) {\n        return tokType.LABEL;\n    }\n    else {\n        return tokType.name;\n    }\n}\n// TODO: duplicated code to avoid extracting another sub-package -- how to avoid?\nfunction hasTokenLabel(obj) {\n    return (0, isString_1.default)(obj.LABEL) && obj.LABEL !== \"\";\n}\nvar AbstractProduction = /** @class */ (function () {\n    function AbstractProduction(_definition) {\n        this._definition = _definition;\n    }\n    Object.defineProperty(AbstractProduction.prototype, \"definition\", {\n        get: function () {\n            return this._definition;\n        },\n        set: function (value) {\n            this._definition = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    AbstractProduction.prototype.accept = function (visitor) {\n        visitor.visit(this);\n        (0, forEach_1.default)(this.definition, function (prod) {\n            prod.accept(visitor);\n        });\n    };\n    return AbstractProduction;\n}());\nexports.AbstractProduction = AbstractProduction;\nvar NonTerminal = /** @class */ (function (_super) {\n    __extends(NonTerminal, _super);\n    function NonTerminal(options) {\n        var _this = _super.call(this, []) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    Object.defineProperty(NonTerminal.prototype, \"definition\", {\n        get: function () {\n            if (this.referencedRule !== undefined) {\n                return this.referencedRule.definition;\n            }\n            return [];\n        },\n        set: function (definition) {\n            // immutable\n        },\n        enumerable: false,\n        configurable: true\n    });\n    NonTerminal.prototype.accept = function (visitor) {\n        visitor.visit(this);\n        // don't visit children of a reference, we will get cyclic infinite loops if we do so\n    };\n    return NonTerminal;\n}(AbstractProduction));\nexports.NonTerminal = NonTerminal;\nvar Rule = /** @class */ (function (_super) {\n    __extends(Rule, _super);\n    function Rule(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.orgText = \"\";\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return Rule;\n}(AbstractProduction));\nexports.Rule = Rule;\nvar Alternative = /** @class */ (function (_super) {\n    __extends(Alternative, _super);\n    function Alternative(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.ignoreAmbiguities = false;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return Alternative;\n}(AbstractProduction));\nexports.Alternative = Alternative;\nvar Option = /** @class */ (function (_super) {\n    __extends(Option, _super);\n    function Option(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return Option;\n}(AbstractProduction));\nexports.Option = Option;\nvar RepetitionMandatory = /** @class */ (function (_super) {\n    __extends(RepetitionMandatory, _super);\n    function RepetitionMandatory(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return RepetitionMandatory;\n}(AbstractProduction));\nexports.RepetitionMandatory = RepetitionMandatory;\nvar RepetitionMandatoryWithSeparator = /** @class */ (function (_super) {\n    __extends(RepetitionMandatoryWithSeparator, _super);\n    function RepetitionMandatoryWithSeparator(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return RepetitionMandatoryWithSeparator;\n}(AbstractProduction));\nexports.RepetitionMandatoryWithSeparator = RepetitionMandatoryWithSeparator;\nvar Repetition = /** @class */ (function (_super) {\n    __extends(Repetition, _super);\n    function Repetition(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return Repetition;\n}(AbstractProduction));\nexports.Repetition = Repetition;\nvar RepetitionWithSeparator = /** @class */ (function (_super) {\n    __extends(RepetitionWithSeparator, _super);\n    function RepetitionWithSeparator(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return RepetitionWithSeparator;\n}(AbstractProduction));\nexports.RepetitionWithSeparator = RepetitionWithSeparator;\nvar Alternation = /** @class */ (function (_super) {\n    __extends(Alternation, _super);\n    function Alternation(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        _this.ignoreAmbiguities = false;\n        _this.hasPredicates = false;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    Object.defineProperty(Alternation.prototype, \"definition\", {\n        get: function () {\n            return this._definition;\n        },\n        set: function (value) {\n            this._definition = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return Alternation;\n}(AbstractProduction));\nexports.Alternation = Alternation;\nvar Terminal = /** @class */ (function () {\n    function Terminal(options) {\n        this.idx = 1;\n        (0, assign_1.default)(this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n    }\n    Terminal.prototype.accept = function (visitor) {\n        visitor.visit(this);\n    };\n    return Terminal;\n}());\nexports.Terminal = Terminal;\nfunction serializeGrammar(topRules) {\n    return (0, map_1.default)(topRules, serializeProduction);\n}\nexports.serializeGrammar = serializeGrammar;\nfunction serializeProduction(node) {\n    function convertDefinition(definition) {\n        return (0, map_1.default)(definition, serializeProduction);\n    }\n    /* istanbul ignore else */\n    if (node instanceof NonTerminal) {\n        var serializedNonTerminal = {\n            type: \"NonTerminal\",\n            name: node.nonTerminalName,\n            idx: node.idx\n        };\n        if ((0, isString_1.default)(node.label)) {\n            serializedNonTerminal.label = node.label;\n        }\n        return serializedNonTerminal;\n    }\n    else if (node instanceof Alternative) {\n        return {\n            type: \"Alternative\",\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof Option) {\n        return {\n            type: \"Option\",\n            idx: node.idx,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof RepetitionMandatory) {\n        return {\n            type: \"RepetitionMandatory\",\n            idx: node.idx,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof RepetitionMandatoryWithSeparator) {\n        return {\n            type: \"RepetitionMandatoryWithSeparator\",\n            idx: node.idx,\n            separator: (serializeProduction(new Terminal({ terminalType: node.separator }))),\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof RepetitionWithSeparator) {\n        return {\n            type: \"RepetitionWithSeparator\",\n            idx: node.idx,\n            separator: (serializeProduction(new Terminal({ terminalType: node.separator }))),\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof Repetition) {\n        return {\n            type: \"Repetition\",\n            idx: node.idx,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof Alternation) {\n        return {\n            type: \"Alternation\",\n            idx: node.idx,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof Terminal) {\n        var serializedTerminal = {\n            type: \"Terminal\",\n            name: node.terminalType.name,\n            label: tokenLabel(node.terminalType),\n            idx: node.idx\n        };\n        if ((0, isString_1.default)(node.label)) {\n            serializedTerminal.terminalLabel = node.label;\n        }\n        var pattern = node.terminalType.PATTERN;\n        if (node.terminalType.PATTERN) {\n            serializedTerminal.pattern = (0, isRegExp_1.default)(pattern)\n                ? pattern.source\n                : pattern;\n        }\n        return serializedTerminal;\n    }\n    else if (node instanceof Rule) {\n        return {\n            type: \"Rule\",\n            name: node.name,\n            orgText: node.orgText,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else {\n        throw Error(\"non exhaustive match\");\n    }\n}\nexports.serializeProduction = serializeProduction;\n//# sourceMappingURL=model.js.map"]},"metadata":{},"sourceType":"script"}